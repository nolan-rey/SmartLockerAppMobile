<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SmartLockerApp.Views.LoginPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SmartLockerApp.ViewModels"
             xmlns:converters="clr-namespace:SmartLockerApp.Converters"
             Title="Connexion"
             BackgroundColor="#F8FAFC"
             x:DataType="viewmodels:LoginViewModel">
    
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <Grid Padding="20" RowDefinitions="*,Auto,*">
            
            <!-- Main Card -->
            <Border x:Name="LoginCard"
                    Grid.Row="1" 
                    BackgroundColor="White" 
                    StrokeThickness="0"
                    MaximumWidthRequest="400"
                    HorizontalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.1" Radius="20" Offset="0,0"/>
                </Border.Shadow>
                
                <StackLayout Padding="32" Spacing="24">
                    
                    <!-- Logo Section -->
                    <StackLayout HorizontalOptions="Center" Spacing="16">
                        <Image Source="smartlocker_logo.svg" 
                               WidthRequest="120" 
                               HeightRequest="120"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Aspect="AspectFit"/>
                        <StackLayout HorizontalOptions="Center" Spacing="8">
                            <Label Text="Connexion" 
                                   FontSize="28" 
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Center"
                                   TextColor="Black"/>
                            <Label Text="Accédez à votre compte SmartLocker" 
                                   FontSize="16" 
                                   TextColor="Gray" 
                                   HorizontalOptions="Center"/>
                        </StackLayout>
                    </StackLayout>
                    
                    <!-- Error Message -->
                    <Border x:Name="ErrorBorder" 
                            BackgroundColor="#FEF2F2" 
                            Stroke="#FCA5A5" 
                            StrokeThickness="1" 
                            Padding="12"
                            IsVisible="False">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8"/>
                        </Border.StrokeShape>
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="⚠" FontSize="16" TextColor="#DC2626"/>
                            <Label x:Name="ErrorLabel" Text="" FontSize="14" TextColor="#DC2626"/>
                        </StackLayout>
                    </Border>
                    
                    <!-- Login Form -->
                    <StackLayout Spacing="20">
                        
                        <!-- Email Field -->
                        <StackLayout Spacing="8">
                            <Label Text="Adresse email" FontSize="14" FontAttributes="Bold"/>
                            <Entry Text="{Binding Email}" 
                                   Placeholder="votre@email.com"
                                   FontSize="16"
                                   BackgroundColor="White"
                                   HeightRequest="48"
                                   Keyboard="Email"/>
                        </StackLayout>
                        
                        <!-- Password Field -->
                        <StackLayout Spacing="8">
                            <Label Text="Mot de passe" FontSize="14" FontAttributes="Bold"/>
                            <Grid>
                                <Entry Text="{Binding Password}" 
                                       Placeholder="••••••••"
                                       FontSize="16"
                                       BackgroundColor="White"
                                       HeightRequest="48"
                                       IsPassword="{Binding IsPasswordVisible, Converter={StaticResource InvertBoolConverter}}"/>
                                <Button Command="{Binding TogglePasswordVisibilityCommand}" 
                                        HorizontalOptions="End" 
                                        VerticalOptions="Center"
                                        Margin="0,0,12,0"
                                        BackgroundColor="Transparent"
                                        Text="{Binding PasswordVisibilityIcon}"
                                        FontSize="16"
                                        BorderWidth="0"/>
                            </Grid>
                        </StackLayout>
                        
                        <!-- Forgot Password Link -->
                        <Button Command="{Binding ForgotPasswordCommand}" 
                                Text="Mot de passe oublié ?" 
                                HorizontalOptions="End"
                                FontSize="14"
                                TextColor="#2563EB"
                                BackgroundColor="Transparent"
                                BorderWidth="0"/>
                        
                        <!-- Login Button -->
                        <Button Command="{Binding LoginCommand}" 
                                Text="Se connecter"
                                FontSize="16"
                                FontAttributes="Bold"
                                BackgroundColor="#2563EB"
                                TextColor="White"
                                HeightRequest="48"
                                CornerRadius="8">
                            <Button.Shadow>
                                <Shadow Brush="#2563EB" Opacity="0.2" Radius="8" Offset="0,2"/>
                            </Button.Shadow>
                        </Button>
                        
                    </StackLayout>
                    
                    <!-- Signup Link -->
                    <StackLayout>
                        <BoxView BackgroundColor="#E5E7EB" HeightRequest="1" Margin="0,16,0,16"/>
                        <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="4">
                            <Label Text="Pas encore de compte ?" FontSize="14" TextColor="Gray"/>
                            <Button Command="{Binding NavigateToSignupCommand}" 
                                    Text="Créer un compte" 
                                    FontSize="14"
                                    TextColor="#2563EB"
                                    BackgroundColor="Transparent"
                                    BorderWidth="0"/>
                        </StackLayout>
                    </StackLayout>
                    
                </StackLayout>
            </Border>
        </Grid>
    </ScrollView>
</ContentPage>
